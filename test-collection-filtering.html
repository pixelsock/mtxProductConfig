<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Collection Filtering</title>
</head>
<body>
    <div id="app">
        <h1>Testing Collection Filtering</h1>
        <div id="logs"></div>
    </div>
    <script type="module">
        console.log('üîß Testing collection filtering fix...');

        // Import the configurator store
        import { useConfiguratorStore } from './src/store/index.ts';

        // Wait for DOM to load then test
        document.addEventListener('DOMContentLoaded', async () => {
            const logs = document.getElementById('logs');

            function addLog(message) {
                console.log(message);
                logs.innerHTML += `<p>${message}</p>`;
            }

            addLog('üîß Starting collection filtering test...');

            try {
                // Get store state
                const store = useConfiguratorStore.getState();
                addLog(`üîß Initial store state loaded`);

                // Check current product line
                addLog(`üîß Current product line: ${store.currentProductLine?.name || 'None'}`);
                addLog(`üîß Default options: ${JSON.stringify(store.currentProductLine?.default_options?.slice(0, 3) || 'undefined')}`);

                // Check if product options are loaded
                addLog(`üîß Product options loaded: ${!!store.productOptions}`);
                addLog(`üîß Configuration UI records: ${store.productOptions?.configurationUI?.length || 0}`);

                // Test the component mapping
                if (store.productOptions?.configurationUI && store.currentProductLine) {
                    addLog('üîß Testing buildOrderedComponentConfigs...');

                    const { buildOrderedComponentConfigs } = await import('./src/utils/componentMapping.ts');

                    const result = buildOrderedComponentConfigs(
                        store.productOptions.configurationUI,
                        store.productOptions,
                        store.currentProductLine
                    );

                    addLog(`üîß Component configs result: ${result.length} components visible`);
                    addLog(`üîß Component collections: ${result.map(c => c.collection).join(', ')}`);
                }

            } catch (error) {
                addLog(`‚ùå Error: ${error.message}`);
                console.error('Error in test:', error);
            }
        });
    </script>
</body>
</html>