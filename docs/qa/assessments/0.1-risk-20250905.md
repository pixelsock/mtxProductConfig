# Risk Profile: Story 0.1 — System Analysis and SKU Correlation

Date: 2025-09-05
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 1
- High Risks: 2
- Medium Risks: 1
- Low Risks: 1
- Gate Signal: CONCERNS (high risks present)

### Risk Summary (YAML for gate file)

```yaml
risk_summary:
  totals:
    critical: 1
    high: 2
    medium: 1
    low: 1
  highest:
    id: DATA-001
    score: 9
    title: 'SKU correlation mismatch across systems'
  recommendations:
    must_fix:
      - 'Implement authoritative SKU mapping for Deco frame thickness'
      - 'Add unit + E2E tests for URL ↔ selection ↔ SKU consistency'
      - 'Handle NULL product line SKU explicitly in `buildFullSku()`'
    monitor:
      - 'Alert on SKU/selection mismatch events (Sentry/analytics)'
      - 'Track rules evaluation failures impacting SKU first character'
```

## Critical Risks Requiring Immediate Attention

### 1. DATA-001: SKU correlation mismatch across systems

Score: 9 (Critical)

- Probability: High — Multiple integration points (search, rules, selection, URL params) increase mismatch chance.
- Impact: High — Wrong SKU can lead to misorders, revenue loss, and support burden.
- Mitigation:
  - Establish a single source of truth for SKU composition (product-line vs product overrides).
  - Add cross-checks: URL ↔ selection ↔ displayed SKU must match before allowing progression.
  - Add unit tests for `buildFullSku()` and E2E tests covering wide/thin frames and Deco NULL SKU.
  - Emit analytics events on mismatch; block checkout if inconsistencies detected.

## Risk Matrix

| Risk ID   | Description                                                     | Probability | Impact   | Score | Priority |
|-----------|-----------------------------------------------------------------|-------------|----------|-------|----------|
| DATA-001  | SKU correlation mismatch across systems                         | High (3)    | High (3) | 9     | Critical |
| TECH-001  | Deco NULL SKU leads to incorrect first-char derivation          | Medium (2)  | High (3) | 6     | High     |
| BUS-001   | Misgenerated SKUs cause misorders/revenue impact                | Medium (2)  | High (3) | 6     | High     |
| OPS-001   | No monitoring/alerts for SKU vs selection mismatch              | Medium (2)  | Medium(2)| 4     | Medium   |
| PERF-001  | SKU recomputation causes UI jank during option changes          | Low (1)     | Medium(2)| 2     | Low      |

## Detailed Risks and Mitigations

### TECH-001: Deco NULL SKU leads to incorrect first-char derivation (Score 6)
- Probability: Medium — Code paths handling NULL/override differ across components.
- Impact: High — First character governs product line; wrong mapping breaks SKU semantics.
- Mitigation:
  - Treat NULL product-line SKU as “computed” via rules for frame thickness.
  - Add explicit mapping table for first-character per frame thickness and product line.
  - Validate in `buildFullSku()` with fallbacks and exhaustive tests.

### BUS-001: Misgenerated SKUs cause misorders/revenue impact (Score 6)
- Probability: Medium — Downstream systems depend on SKU correctness.
- Impact: High — Wrong fulfillment, returns, lost revenue, reputation damage.
- Mitigation:
  - Add pre-checks before presenting SKU externally or enabling checkout.
  - Temporary safeguard: banner/warning when SKU derived from NULL path.

### OPS-001: No monitoring for SKU/selection mismatch (Score 4)
- Probability: Medium — Easy to miss without instrumentation.
- Impact: Medium — Latent defects persist until reported.
- Mitigation:
  - Emit structured logs and analytics on generation and on mismatch.
  - Add SLOs/KPIs and alerting for mismatch and rules-evaluation errors.

### PERF-001: SKU recomputation causes UI jank (Score 2)
- Probability: Low — Likely acceptable complexity; risk increases with added rules.
- Impact: Medium — Degraded UX under heavy option changes.
- Mitigation:
  - Memoize SKU parts; debounce non-critical recomputations.
  - Profile rule evaluation; cache deterministic lookups.

## Risk-Based Testing Strategy

- Priority 1 (Critical): Cross-system consistency tests for URL ↔ selection ↔ SKU; E2E around frame thickness (Deco).
- Priority 2 (High): Unit coverage for `buildFullSku()` branches; rules-engine integration tests for first character mapping.
- Priority 3 (Med/Low): Performance sanity under rapid option changes; monitoring/telemetry verification.

## Risk Acceptance Criteria

- Must fix before production: All score 9; all score 6 touching security/data correctness (applies to TECH-001, BUS-001).
- Can deploy with mitigation: Score 4 with monitoring in place.
- Accepted risks: Score 2 with perf monitoring and memoization plan.

## Monitoring Requirements

- Create analytics event: `sku_mismatch_detected` with context (product line, options, URL params).
- Alert on rules evaluation errors affecting first-character derivation.
- Dashboard: SKU consistency rate, rules error rate, SKU generation latency.

---

Risk profile: docs/qa/assessments/0.1-risk-20250905.md

