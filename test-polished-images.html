<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Polished Images</title>
  <script type="module">
    // Import Supabase client
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const supabase = createClient(
      'https://akwhptzlqgtlcpzvcnjl.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrd2hwdHpscWd0bGNwenZjbmpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzExOTk0MTQsImV4cCI6MjA0Njc3NTQxNH0.9VPMkLJZkVoLFuR9BBLJ3-t_kjNJLOY5yemY2stAWMw'
    );

    async function testPolishedProduct() {
      console.log('üîç Testing Polished Product Images...');

      // Fetch Polished product with joins
      const { data: products, error } = await supabase
        .from('products')
        .select(`
          *,
          vertical_image_file:directus_files!products_vertical_image_foreign(id, filename_disk, storage),
          horizontal_image_file:directus_files!products_horizontal_image_foreign(id, filename_disk, storage)
        `)
        .eq('product_line', 23)
        .eq('active', true);

      if (error) {
        console.error('‚ùå Error fetching products:', error);
        document.body.innerHTML = `<h1>Error</h1><pre>${JSON.stringify(error, null, 2)}</pre>`;
        return;
      }

      console.log('‚úÖ Products fetched:', products);

      if (products && products.length > 0) {
        const product = products[0];
        console.log('üì¶ Product:', product);
        console.log('üñºÔ∏è Vertical Image:', product.vertical_image);
        console.log('üñºÔ∏è Horizontal Image:', product.horizontal_image);
        console.log('üìÅ Vertical Image File:', product.vertical_image_file);
        console.log('üìÅ Horizontal Image File:', product.horizontal_image_file);

        // Construct image URLs
        const verticalUrl = `https://pim.dude.digital/assets/${product.vertical_image}`;
        const horizontalUrl = `https://pim.dude.digital/assets/${product.horizontal_image}`;

        console.log('üîó Vertical URL:', verticalUrl);
        console.log('üîó Horizontal URL:', horizontalUrl);

        // Display results
        document.getElementById('results').innerHTML = `
          <h2>Product: ${product.name}</h2>
          <p><strong>Product Line ID:</strong> ${product.product_line}</p>
          <p><strong>Vertical Image UUID:</strong> ${product.vertical_image}</p>
          <p><strong>Horizontal Image UUID:</strong> ${product.horizontal_image}</p>
          <p><strong>Vertical Image File:</strong> ${JSON.stringify(product.vertical_image_file)}</p>
          <p><strong>Horizontal Image File:</strong> ${JSON.stringify(product.horizontal_image_file)}</p>

          <h3>Vertical Image:</h3>
          <img src="${verticalUrl}" style="max-width: 400px;" onload="console.log('‚úÖ Vertical image loaded')" onerror="console.error('‚ùå Vertical image failed')">

          <h3>Horizontal Image:</h3>
          <img src="${horizontalUrl}" style="max-width: 400px;" onload="console.log('‚úÖ Horizontal image loaded')" onerror="console.error('‚ùå Horizontal image failed')">
        `;
      } else {
        document.getElementById('results').innerHTML = '<h2>No products found</h2>';
      }
    }

    // Run test when page loads
    testPolishedProduct();
  </script>
</head>
<body>
  <h1>Testing Polished Product Images</h1>
  <div id="results">Loading...</div>
</body>
</html>